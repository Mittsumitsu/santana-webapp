# 🏨 サンタナゲストハウス予約システム - 完璧版

[![Node.js](https://img.shields.io/badge/Node.js-16+-green.svg)](https://nodejs.org/)
[![React](https://img.shields.io/badge/React-18+-blue.svg)](https://reactjs.org/)
[![Firebase](https://img.shields.io/badge/Firebase-9+-orange.svg)](https://firebase.google.com/)
[![Discord](https://img.shields.io/badge/Discord-Integration-7289da.svg)](https://discord.com/)

## 🎯 プロジェクト概要

サンタナゲストハウス（デリー・バラナシ・プリー）の統合予約システム。
高度な組み合わせエンジンにより、1～3室の最適な宿泊プランを提案します。

## ✨ 完成機能（Phase 1）

### 🔍 高度な検索システム
- **1-3室組み合わせ最適化**: 最大18パターン自動生成
- **男女混合対応**: 性別制限を考慮した適切な部屋配分
- **重複完全除去**: 実質的に同じ組み合わせの排除
- **0人部屋問題解決**: 使用されない部屋の完全除外
- **🆕 空室状況チェック**: リアルタイムの予約状況反映

### 💰 動的料金システム
- **複雑な料金体系**: 部屋タイプ・人数別の正確な計算
- **推奨度評価**: 効率性とコスパを総合評価
- **価格順ソート**: 最適な選択肢を優先表示

### 📱 完璧なUI/UX
- **レスポンシブデザイン**: モバイル・デスクトップ完全対応
- **🆕 予約機能**: 完全動作・Firebase連携完了
- **直感的操作**: ワンクリックで詳細表示・予約

### 🔥 **Firebase完全統合**
- **🆕 予約データベース**: Firestoreによる完全なデータ管理
- **🆕 トランザクション処理**: データ整合性の確保
- **🆕 空室管理**: 予約済み部屋の自動除外システム
- **🆕 リアルタイム同期**: 複数ユーザー同時利用対応

## 🎯 解決した技術課題

1. ✅ **ツイン×2室表示**: 男女混合で同部屋タイプ組み合わせ
2. ✅ **予約ボタン機能**: ESLintエラー解消・動作実装
3. ✅ **重複除去**: 完璧な重複排除システム
4. ✅ **0人部屋除外**: 使用されない部屋の完全除外
5. ✅ **性別制限対応**: ドミトリー男女制限の完璧な処理
6. ✅ **🆕 空室状況管理**: 予約済み部屋の自動除外
7. ✅ **🆕 Firestore連携**: 完全なバックエンド統合
8. ✅ **🆕 トランザクション修正**: 読み書き順序問題の解決

## 🏗️ 技術スタック

**バックエンド**: Node.js + Express + Firebase Admin SDK  
**フロントエンド**: React + CSS3  
**データベース**: Cloud Firestore  
**認証**: Firebase Authentication  
**API**: RESTful API設計

## 🚀 セットアップ

```bash
# バックエンド起動
cd backend
npm install
npm start  # ポート3000

# フロントエンド起動
cd frontend
npm install  
npm start  # ポート3001
```

## 📊 **Phase 2 実装予定: 運営効率化システム**

### 🔔 **Discord通知システム（最優先）**

#### **統括Discord（主要スタッフ向け）**
- 📩 **新規予約申請通知**: 詳細情報付きリアルタイム通知
- ✅ **承認/拒否結果**: 予約状況の即座更新
- 💰 **決済完了通知**: 売上の自動集計・報告
- 📊 **日次/週次レポート**: 稼働率・売上の自動分析
- 🚨 **システムエラー**: 重要アラートの即座配信

#### **店舗別Discord（現場スタッフ向け）**
- 📅 **当日チェックイン予定**: 毎朝自動送信
- ✅ **チェックイン完了報告**: リアルタイム状況共有
- 🧹 **清掃完了通知**: 部屋準備状況の管理
- 🇬🇧 **英語併記**: 海外スタッフ向け対応
- 🍽️ **食事注文**: 既存システムとの統合

### 💳 **Stripe決済システム**
- **オンライン決済**: クレジットカード・デビットカード対応
- **事前決済**: 送迎サービス等の必須決済
- **現地決済**: 通常宿泊での選択制
- **自動決済リンク**: 承認後の即座生成・送信

### 👥 **権限管理システム**
```javascript
権限レベル設計:
├── 👑 管理者: 全機能アクセス
├── 👨‍💼 主要スタッフ×2: 予約管理 + レポート閲覧
├── 👨‍🔧 デリースタッフ: デリー店限定管理
├── 👨‍🔧 バラナシスタッフ: バラナシ店限定管理
└── 👨‍🔧 プリースタッフ: プリー店限定管理
```

### 📋 **承認管理システム**
- **手動承認フロー**: Airbnb方式の品質管理
- **承認管理画面**: ワンクリック承認/拒否
- **24時間承認期限**: 自動期限管理
- **承認基準ガイド**: 一貫した判断基準

## 🔐 **Phase 3-5: エンタープライズセキュリティシステム**

### 🏢 多階層ユーザー管理システム

#### **ユーザー権限レベル**
👑 管理者 (Level 4)    - 全システム管理権限  
👨‍💼 主要スタッフ (Level 3) - 運営・予約管理権限  
👨‍🔧 店舗スタッフ (Level 2) - 限定的な現場対応権限  
👤 宿泊客 (Level 1)    - 個人予約管理権限

### 🛡️ Google-gradeセキュリティ

#### **セキュリティレベル説明**
- **銀行ATMレベル**: Firebase Authenticationによる多重認証
- **暗号化通信**: 全データ通信の完全暗号化
- **24/7監視**: Google社による世界規模のセキュリティ監視
- **自動脅威検知**: 異常アクセスの即座検知・ブロック

#### **ITに疎い方への安心説明**
🏠 従来システム = 普通の家の鍵（1つの鍵のみ）  
🏰 Firebase = 超高級マンション  
↳ オートロック + 監視カメラ + 警備員常駐  
↳ Googleが世界20億人を守る技術と同一

### 🔒 内部不正対策システム

#### **悪意ある内部者への防御**
```javascript
// 権限マトリックス例
┌─────────────┬────┬────┬────┬──────┐
│ 機能        │ 客 │店舗│主要│管理者│
├─────────────┼────┼────┼────┼──────┤
│ 自分の予約   │ ✅ │ ❌ │ ✅ │  ✅  │
│ 全予約閲覧   │ ❌ │📅*1│ ✅ │  ✅  │
│ 料金設定     │ ❌ │ ❌ │🔒*2│  ✅  │
│ スタッフ管理 │ ❌ │ ❌ │ ❌ │  ✅  │
└─────────────┴────┴────┴────┴──────┘
*1: 当日分のみ、個人情報制限  
*2: 一定範囲内、承認制
```

#### **多重防御システム**
- **認証層**: Firebase Authentication + 2段階認証
- **認可層**: 役割ベースアクセス制御（RBAC）
- **監査層**: 全操作ログ + 異常検知
- **データ層**: 暗号化 + アクセス制限

#### **緊急時自動対応**
```
🚨 異常行動検知時
├─ アカウント自動停止
├─ 管理者即座通知  
├─ 操作ログ保存
└─ セキュリティレポート生成
```

### 🔑 認証システム仕様

#### **ログイン方式選択**
📧 **メール + パスワード方式**  
├─ 従来型、全世代対応  
├─ 自社管理、カスタマイズ可能  
└─ パスワードポリシー適用

🔘 **Googleアカウント方式**  
├─ ワンクリックログイン  
├─ Googleの2段階認証自動適用  
└─ パスワード管理不要

#### **セキュリティ機能**
- **自動ログアウト**: 非アクティブ時の自動セッション切断
- **デバイス管理**: 登録デバイス以外からのアクセス制限
- **地域制限**: 海外からの不審なアクセスをブロック
- **ブルートフォース防御**: 連続ログイン失敗時のアカウント保護

### 👤 ユーザーエクスペリエンス向上

#### **代表者情報自動入力**
**従来**: 毎回全情報を手入力  
**改善**: 代表者情報は自動設定  
├─ 氏名、連絡先は初回登録済みデータを使用  
├─ 追加ゲスト情報のみ入力  
└─ リピート予約時の手間を大幅削減

#### **予約履歴管理**
- ✅ 過去の宿泊履歴一覧
- ✅ 同じ条件での再予約ワンクリック
- ✅ よく利用する部屋タイプの優先表示
- ✅ 記念日・誕生日での自動おすすめ通知

## 🎯 実装フェーズ

### **Phase 1: 予約システム基盤 ✅ 完了**
- ✅ Firebase Authentication設定
- ✅ 空室検索・組み合わせエンジン
- ✅ 予約機能・Firestore連携
- ✅ 基本的なUI/UX

### **Phase 2: 運営効率化 🔥 実装中**
- 🔄 Discord通知システム
- ⏳ Stripe決済統合
- ⏳ 承認管理システム
- ⏳ ユーザーページ

### **Phase 3: 認証システム基盤 (予定: 2025年夏)**
- 🔮 Firebase Authentication設定
- 🔮 ユーザー登録・ログインシステム
- 🔮 基本的な権限管理
- 🔮 プロファイル管理機能

### **Phase 4: 高度なセキュリティ (予定: 2025年秋)**
- 🔮 多階層権限システム実装
- 🔮 詳細な監査ログシステム
- 🔮 異常検知・自動対応システム
- 🔮 管理者ダッシュボード

### **Phase 5: UX最適化 (予定: 2025年冬)**
- 🔮 代表者情報自動入力
- 🔮 予約履歴・再予約システム
- 🔮 パーソナライズされた推奨機能
- 🔮 モバイルアプリ連携

## 🏆 目指すシステム像

🏨 **サンタナゲストハウス予約システム**  
├─ 🔒 銀行レベルのセキュリティ  
├─ 👥 全スタッフ・全世代対応のUI  
├─ 🚀 リピーター優遇のUX  
├─ 📊 詳細な運営分析機能  
└─ 🌍 多店舗展開対応の拡張性

**セキュリティ**: 悪意ある内部者でもシステム全体を危険にできない設計  
**利便性**: ITに疎い方でも安心して使える直感的インターフェース  
**効率性**: リピーター向けの大幅な手間削減とパーソナライゼーション

## 📞 **現在の開発状況**

**🎉 Phase 1 完全完了**: 予約システムが実運用可能レベルで稼働中  
**🔥 Phase 2 開始**: Discord通知システムの実装準備完了  
**🎯 次のマイルストーン**: 手動承認フロー + Stripe決済システム

---

**最終更新**: 2025年6月1日  
**開発チーム**: サンタナゲストハウス IT部門  
**技術サポート**: Claude (Anthropic)